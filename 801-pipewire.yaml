# Install required packages
# Packages for VMs and Physical Machines
required_packages:
  packages:
    command: 'yay -S {package} --needed --noconfirm'
    package:
      - 'world/pipewire'
      - 'world/wireplumber'
      - 'world/pipewire-alsa'
      - 'world/pipewire-pulse'
      - 'world/pipewire-jack'
      # - 'world/pipewire-media-session'
      - 'world/gst-plugin-pipewire'
      - 'world/alsa-utils'
      - 'world/libcamera'
configuration:
  file:
      # Create a PipeWire configuration file if needed (optional)
    create: true
    name: '~/.xinitrc'
    content: |
      #!/bin/sh

      /usr/bin/pipewire &
      /usr/bin/pipewire-pulse &
      # /usr/bin/pipewire-media-session &
      /usr/bin/wireplumber &
      exec dbus-launch --exit-with-session startplasma-x11
  file:
    # Create a PipeWire configuration file if needed (optional)
    create: true
    name: '~/.xprofile'
    content: |
      #!/bin/sh

      /usr/bin/pipewire &
      /usr/bin/pipewire-pulse &
      # /usr/bin/pipewire-media-session &
      /usr/bin/wireplumber &
  shell:
    - 'chmod +x ~/.xinitrc'
  file:
    # Create a PipeWire configuration file if needed (optional)
    create: true
    name: '/etc/pipewire/pipewire.conf'
    content: |
      # Example PipeWire configuration
      context.properties = {
        default.clock.rate          = 48000
        default.clock.allowed-rates = [ 48000 ]
        default.clock.quantum       = 1024
        default.clock.min-quantum   = 32
        default.clock.max-quantum   = 8192
    }
